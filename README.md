# A/B Test Extension for SillyTavern

SillyTavern의 프롬프트 설정을 스냅샷으로 저장하고, 서로 다른 설정 간의 차이를 비교하며, 동일한 입력에 대해 각 설정이 어떤 응답을 생성하는지 테스트할 수 있는 확장 프로그램입니다.

## 주요 기능

### 1. 스냅샷 저장 및 관리
- 현재 프롬프트 설정을 스냅샷으로 저장
- IndexedDB를 사용하여 영구 저장 (브라우저 종료 후에도 유지)
- 각 스냅샷에 현재 프리셋 이름 자동 포함
- 스냅샷 삭제 기능

### 2. 프리셋 빠른 변경
- 확장 팝업에서 바로 프리셋 변경 가능
- **Apply**: 선택한 프리셋으로 즉시 변경
- **Apply & Save**: 프리셋 변경 후 바로 스냅샷 저장
- 현재 적용된 프리셋 이름 표시

### 3. 스냅샷 비교 (Diff)
- 두 개의 스냅샷을 선택하여 차이점 비교
- 색상으로 구분된 시각적 diff 표시:
  - 🔴 **빨간색**: 제거된 프롬프트
  - 🟢 **녹색**: 추가된 프롬프트
  - 🟠 **주황색**: 내용이 변경된 프롬프트
- 활성화/비활성화 상태 변경 표시 (ON/OFF)

### 4. 상세 비교 모달
- 변경된 프롬프트 클릭 시 2열 비교 뷰 표시
- **라인 단위 하이라이트**: 변경된 라인 강조
- **단어 단위 하이라이트**: 같은 라인 내 변경된 단어 개별 강조
  - 추가된 단어: 녹색 배경
  - 삭제된 단어: 빨간색 배경 + 취소선

### 5. 프롬프트 뷰어
- 스냅샷의 전체 프롬프트 목록 확인
- 각 프롬프트의 이름, 역할(role), 활성화 상태, 내용 표시

### 6. A/B 테스트 실행
- 두 설정(A, B)에 대해 동일한 입력으로 응답 생성
- **실시간 스트리밍**: 응답이 생성되는 과정을 실시간으로 표시
- 테스트 메시지 입력 가능 (비워두면 현재 채팅 기록 사용)
- 두 응답을 나란히 비교

## 사용 방법

### 기본 워크플로우

1. **확장 프로그램 열기**
   - 요술봉 메뉴에서 "A/B Test" 클릭

2. **스냅샷 저장**
   - 현재 프롬프트 설정이 마음에 들면 "Save Current" 클릭
   - 스냅샷 이름 입력

3. **프리셋 비교 (다른 프리셋 테스트)**
   - "Quick Preset Switch"에서 다른 프리셋 선택
   - "Apply & Save"로 새 프리셋 적용 + 스냅샷 저장
   - 이제 두 프리셋의 스냅샷을 비교 가능

4. **비교할 스냅샷 선택**
   - 첫 번째 스냅샷 클릭 → Slot A에 배치
   - 두 번째 스냅샷 클릭 → Slot B에 배치
   - 또는 "Use Current Config"로 현재 설정과 비교

5. **차이점 확인**
   - Differences 섹션에서 변경사항 확인
   - 변경된 프롬프트 클릭 시 상세 비교 보기
   - 상세 비교시 바뀐 줄, 바뀐 단어만 색상으로 보여서 구분됨

6. **A/B 테스트 실행**
   - (선택) 테스트 메시지 입력
   - "Run A/B Test" 클릭
   - 두 설정의 응답 비교

## 설치

1. https://github.com/dddr7983-create/ab-test 를 확장 인스톨

## 기술 스택

- **저장소**: IndexedDB (브라우저 내장 DB)
- **UI**: SillyTavern Popup API
- **프롬프트 관리**: promptManager API
- **프리셋 관리**: preset-manager API
- **생성**: context.generate('quiet') 메서드